#!/usr/bin/env python

import click
import logging

from lightflow.lightflow import Lightflow

logger = logging.getLogger(__name__)


@click.group()
def cli():
    pass


@click.command()
@click.argument('workflow_name')
@click.option('--workflow-id', default=None, help='Unique workflow ID')
def run(workflow_name, workflow_id):
    lf = Lightflow()
    lf.run_workflow(workflow_name, workflow_id)


@click.command()
@click.argument('workflow_names', nargs=-1)
@click.option('--config', help='Config filename')
def info(workflow_names):
    #lf = Lightflow(config)  # TODO: support template parameters
    #if len(workflow_names) > 0:
    #    # detail
    #    for workflow_name in workflow_names:
    #        dags = lf.get_dags(workflow_name)
    #        for dag in dags:
    #            print(dag.dag_id)
    #    pass
    #else:
    #    # summary
    #    pass
    pass


@click.command()
def worker():
    from lightflow.celery_tasks import run_worker
    run_worker()


cli.add_command(run, 'run')
cli.add_command(info, 'info')
cli.add_command(worker, 'worker')

if __name__ == '__main__':
    cli()
